<html>
  <head>
    <meta charset="utf-8">
    <title>Album Availability Map</title>
    <link rel='shortcut icon' type='image/x-icon' href='favicon.ico' />
  </head>
  <body>
    <a href="/saam/">Go back</>
    <script>
        /**
         * Obtains parameters from the hash of the URL
         * @return Object
         */
        function getHashParams() {
          var hashParams = {};
          var e, r = /([^&;=]+)=?([^&;]*)/g,
              q = window.location.hash.substring(1);
          while ( e = r.exec(q)) {
             hashParams[e[1]] = decodeURIComponent(e[2]);
          }
          return hashParams;
        }
        
        var params = getHashParams();

        var access_token = params.access_token,
            state = params.state,
            storedState = localStorage.getItem('sp-oauth-state-key');
            
            
        if (!access_token || (access_token && (state == null || state !== storedState))) {
          alert('There was an error during the authentication');
        } else {
            localStorage.setItem('atoken', access_token);
            window.location = "/saam/";
        }
    </script>
  </body>
</html>